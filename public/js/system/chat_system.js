// Generated by CoffeeScript 1.9.3

/*
	 * БЛОК ЛОГИКИ ДЛЯ ЧАТА НОВОГО ДИЗАЙНА
 */
App.Models.Chat = Backbone.Model.extend({
  socket: {},
  defaults: function() {
    var data;
    data = {
      name: '',
      avatar: 'assets/img/profiles/d.jpg',
      begin_message: 'Сообщение заглушка',
      count_new_messages: 5,
      status: 'red'
    };
    return data;
  }
});

App.Collections.Consultants = Backbone.Collection.extend({
  model: App.Models.Chat
});

App.InitCollections.Consultants = new App.Collections.Consultants();

App.Collections.Clients = Backbone.Collection.extend({
  model: App.Models.Chat
});

App.InitCollections.Clients = new App.Collections.Clients();

App.Views.ChatElement = Backbone.View.extend({
  tagName: 'div',
  template: _.template($('#chat_element_template').html()),
  initialize: function() {
    return this.model.bind('destroy', this.remove, this);
  },
  render: function() {
    this.$el.html(this.template(this.model.toJSON()));
    return this;
  }
});

App.Views.ConsultantsChatGroup = Backbone.View.extend({
  el: '#consultants-chat-group',
  socket: {},
  consultant_info: consultant_info,
  $consultantsGroup: $('#consultants-chat-group'),
  $clientsGroup: $('#clients-chat-grou p'),
  initialize: function() {
    console.log('Инициализируем чат');
    this.socket = App.Functions.getSocket();
    this.socket.emit('addConsultant', this.consultant_info);
    this.socket.on('addConsultant', function(data) {
      return App.InitCollections.Consultants.create(data);
    });
    this.socket.on('addClient', this.addClient);
    this.socket.on('create', function(data) {
      return console.log('test create', data);
    });
    App.InitCollections.Consultants.on('add', this.addOneConsultant, this);
    return App.InitCollections.Clients.on('add', this.addOneClient, this);
  },
  addOneConsultant: function(model, collection, options) {
    var view;
    console.info('Добавление новго консультанта чат', model.toJSON());
    view = new App.Views.ChatElement({
      model: model
    });
    return this.$el.append(view.render().el);
  }
});

App.InitViews.ConsultantsChatGroup = new App.Views.ConsultantsChatGroup();

App.InitCollections.Consultants.create(consultant_info);
